"use strict";angular.module("hyenaGuestbooksApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ui.router","hyenaAngular","angularMoment"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){a.state("unl-layout",{templateUrl:"views/layouts/unl-layout.html",data:{requireAuth:!0}}).state("unl-layout-kiosk",{templateUrl:"views/layouts/unl-layout-kiosk.html"}).state("unl-layout.guestbooks",{url:"/:groupId",templateUrl:"views/main.html",controller:"MainCtrl"}).state("unl-layout.guestbook_new",{url:"/:groupId/guestbook/new",templateUrl:"views/new.html",controller:"NewCtrl"}).state("unl-layout.guestbook_settings",{url:"/:groupId/guestbook/:guestbookId/settings",templateUrl:"views/settings.html",controller:"SettingsCtrl"}).state("unl-layout.guestbook_view",{url:"/:groupId/guestbook/:guestbookId",templateUrl:"views/guestbook.html",controller:"GuestbookCtrl"}).state("unl-layout-kiosk.guestbook_kiosk",{url:"/:groupId/guestbook/:guestbookId/kiosk",templateUrl:"views/guestbook_kiosk.html",controller:"GuestbookCtrl"}),b.otherwise("/"),c.html5Mode(!0)}]).config(["$httpProvider",function(a){a.interceptors.push(["$injector",function(a){return a.get("AuthInterceptor")}])}]).constant("FBURL","https://hyena-guestbooks.firebaseio.com/").constant("APIKEY","NDI3MDdjMjc2MjM4OTJhNWIwOWJjMzA1").constant("APIPATH","http://st-studio.unl.edu/hyena_platform/public/api/1.0/").constant("PLATFORM_ROOT","http://st-studio.unl.edu/hyena_platform/public/").constant("AUTH_SCOPE","groups"),angular.module("hyenaGuestbooksApp").controller("MainCtrl",["$scope","$rootScope","$stateParams","GuestbookService","FirebaseGroupService",function(a,b,c,d,e){var f=c.groupId;a.groupId=b.currentGroupId=f,angular.isDefined(f)&&""!==f&&e.existsOrAdd(f),""!==f&&(a.guestbooks=d.groupGuestbooks(f,10).$asArray())}]),angular.module("hyenaGuestbooksApp").controller("NewCtrl",["$scope","$rootScope","$stateParams","Notification","GuestbookService",function(a,b,c,d,e){a.kioskMode=!1;var f=c.groupId;a.groupId=b.currentGroupId=f,a.guestbook={created_at:moment().format(),group_id:parseInt(f),track_sign_out:!1,title:""},a.createGuestbook=function(){e.add(a.guestbook,f).then(function(b){console.log(b);var c=b.key();a.go("/"+f+"/guestbook/"+c),d.show("Your guestbook has been created successfully!","success")},function(a){console.log("Create Guestbook Error",a),d.show("There was an error creating your guestbook.","error")})}}]),angular.module("hyenaGuestbooksApp").service("GuestbookService",["$firebase","$q","AppFirebase","UserService",function(a,b,c,d){var e=c.getRef(),f={get:function(b){return b=b.trim(),a(e.child("/guestbooks/"+b))},groupGuestbooks:function(b,c){c=c||20,b=parseInt(b);var d=e.child("guestbooks").orderByChild("group_id").equalTo(b).limitToFirst(c);return a(d)},add:function(b,c){return a(e.child("guestbooks")).$push(b).then(function(b){return a(e.child("/groups/"+c+"/guestbooks")).$set(b.key(),!0),b})},signins:function(b){return a(e.child("/signins").orderByChild("guestbook_id").equalTo(b))},signIn:function(c,f){var g=b.defer(),h=null,i=null;return d.validate(f).then(function(b){h=b.data.users_validated[0],i={start_at:moment().format(),guestbook_id:c,user:h},g.resolve(a(e.child("/signins")).$push(i))},function(a){g.reject(a)}),g.promise}};return f}]),angular.module("hyenaGuestbooksApp").controller("GuestbookCtrl",["$scope","$rootScope","$stateParams","GuestbookService","Notification",function(a,b,c,d,e){a.kioskMode=!1,a.moment=moment;var f=c.groupId;a.groupId=b.currentGroupId=f;var g=a.guestbookId=c.guestbookId,h=d.get(g).$asObject();h.$bindTo(a,"guestbook"),a.signins=d.signins(g).$asArray(),a.showKioskMode=function(){a.hideMainDrawer(),a.kioskMode=!0},a.hideKioskMode=function(){a.showMainDrawer(),a.kioskMode=!1},a.signInUser=function(){d.signIn(g,a.signinNcard).then(function(){a.signinNcard="",a.signinForm.$setUntouched(),e.show("You have been clocked in successfully!","success")},function(a){console.error(a),e.show(a.data,"error")})}}]),angular.module("hyenaGuestbooksApp").controller("SettingsCtrl",["$scope","$rootScope","$stateParams","GuestbookService",function(a,b,c,d){var e=c.groupId;a.groupId=b.currentGroupId=e;var f=a.guestbookId=c.guestbookId,g=d.get(f).$asObject();g.$bindTo(a,"guestbook")}]);